---
import Layout from "../../layouts/Layout.astro";
import SiteHeader from "../../components/SiteHeader.astro";
import SiteFooter from "../../components/SiteFooter.astro";
import { getCollection } from "astro:content";

export async function getStaticPaths() {
  const posts = (await getCollection("blog", ({ data }) => !data.draft))
    .sort((a, b) => a.data.pubDate.getTime() - b.data.pubDate.getTime());

  return posts.map((post, i) => ({
    params: { slug: post.slug },
    props: {
      post,
      prev: i > 0 ? { slug: posts[i - 1].slug, title: posts[i - 1].data.title } : null,
      next: i < posts.length - 1 ? { slug: posts[i + 1].slug, title: posts[i + 1].data.title } : null,
    },
  }));
}

const { post, prev, next } = Astro.props;
const { Content } = await post.render();

const title = post.data.title;
const description = post.data.description;
---

<Layout title={title} description={description}>
  <SiteHeader />

  <main id="top" class="mx-auto max-w-3xl scroll-mt-16 px-4 py-12">
    <div class="flex flex-wrap items-center justify-between gap-3">
      <a class="text-sm font-semibold text-emerald-600 hover:text-emerald-500 dark:text-emerald-400 dark:hover:text-emerald-300" href="/blog/">← Back to Blog</a>

      <div class="flex items-center gap-2 text-sm">
        {next ? (
          <a
            class="rounded-md border border-zinc-300 px-3 py-2 font-semibold text-zinc-900 hover:bg-zinc-50 dark:border-white/15 dark:text-white dark:hover:bg-white/5"
            href={`/blog/${next.slug}/#top`}
          >
            ← Newer
          </a>
        ) : (
          <span class="rounded-md border border-zinc-200 px-3 py-2 text-zinc-500 dark:border-white/10">← Newer</span>
        )}
        {prev ? (
          <a
            class="rounded-md border border-zinc-300 px-3 py-2 font-semibold text-zinc-900 hover:bg-zinc-50 dark:border-white/15 dark:text-white dark:hover:bg-white/5"
            href={`/blog/${prev.slug}/#top`}
          >
            Older →
          </a>
        ) : (
          <span class="rounded-md border border-zinc-200 px-3 py-2 text-zinc-500 dark:border-white/10">Older →</span>
        )}
      </div>
    </div>

    <header class="mt-6">
      <h1 class="text-3xl font-semibold tracking-tight">{title}</h1>
      <div class="mt-2 text-sm text-zinc-500 dark:text-zinc-400">
        {post.data.pubDate.toLocaleDateString("en-CA", { year: "numeric", month: "long", day: "numeric" })}
      </div>
      {description && <p class="mt-4 text-zinc-600 dark:text-zinc-300">{description}</p>}
    </header>

    <article class="markdown mt-10 text-zinc-800 dark:text-zinc-200">
      <Content />
    </article>

    <nav class="mt-12 grid gap-3 border-t border-zinc-200 pt-6 sm:grid-cols-2 dark:border-white/10" aria-label="Post navigation">
      <div>
        {prev && (
          <a
            class="block rounded-xl border border-zinc-200 bg-zinc-50 p-4 hover:bg-zinc-100 dark:border-white/10 dark:bg-white/5 dark:hover:bg-white/10"
            href={`/blog/${prev.slug}/`}
          >
            <div class="text-xs font-semibold text-zinc-500 dark:text-zinc-400">Previous</div>
            <div class="mt-1 font-semibold">{prev.title}</div>
          </a>
        )}
      </div>

      <div class="sm:text-right">
        {next && (
          <a
            class="block rounded-xl border border-zinc-200 bg-zinc-50 p-4 hover:bg-zinc-100 dark:border-white/10 dark:bg-white/5 dark:hover:bg-white/10"
            href={`/blog/${next.slug}/`}
          >
            <div class="text-xs font-semibold text-zinc-500 dark:text-zinc-400">Next</div>
            <div class="mt-1 font-semibold">{next.title}</div>
          </a>
        )}
      </div>
    </nav>
  </main>

  <SiteFooter />
</Layout>
