---
import Layout from "../../layouts/Layout.astro";
import SiteHeader from "../../components/SiteHeader.astro";
import SiteFooter from "../../components/SiteFooter.astro";
import { getCollection } from "astro:content";

export async function getStaticPaths() {
  const posts = await getCollection("blog", ({ data }) => !data.draft);
  return posts.map((post) => ({
    params: { slug: post.slug },
    props: { post },
  }));
}

const { post } = Astro.props;
const { Content } = await post.render();

const title = post.data.title;
const description = post.data.description;
const originalUrl = post.data.originalUrl;
---

<Layout title={title} description={description}>
  <SiteHeader />

  <main class="mx-auto max-w-3xl px-4 py-12">
    <a class="text-sm font-semibold text-emerald-400 hover:text-emerald-300" href="/blog/">‚Üê Back to Blog</a>

    <header class="mt-6">
      <h1 class="text-3xl font-semibold tracking-tight">{title}</h1>
      <div class="mt-2 text-sm text-zinc-400">
        {post.data.pubDate.toLocaleDateString("en-CA", { year: "numeric", month: "long", day: "numeric" })}
      </div>
      {description && <p class="mt-4 text-zinc-300">{description}</p>}
      {originalUrl && (
        <div class="mt-4 text-sm text-zinc-400">
          Originally posted: <a class="underline decoration-white/30 hover:decoration-white" href={originalUrl} target="_blank" rel="noreferrer">{originalUrl}</a>
        </div>
      )}
    </header>

    <article class="markdown mt-10 text-zinc-200">
      <Content />
    </article>
  </main>

  <SiteFooter />
</Layout>
